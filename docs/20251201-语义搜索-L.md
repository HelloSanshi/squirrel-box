# 语义搜索功能

## 📋 任务信息
- 类型：🔴 大功能 (L)
- 状态：✅ 已完成
- 完成时间：2025-12-01

## 🎯 目标

为收藏内容提供基于 Embedding 的语义搜索功能，让用户可以用自然语言查找相关内容，而不仅仅是关键词匹配。

## 🔧 技术方案

### 架构设计

```
收藏内容 → Embedding API → 向量存储 (IndexedDB)
                                ↓
用户搜索 → Embedding API → 余弦相似度计算 → 排序返回
```

### 技术选型

| 组件 | 方案 | 说明 |
|------|------|------|
| **Embedding API** | OpenAI 兼容格式 | 支持 OpenAI、阿里云、硅基流动等 |
| **向量存储** | IndexedDB | 本地存储，无需服务端 |
| **相似度计算** | 余弦相似度 | 浏览器端计算，毫秒级响应 |

### 存储结构

```typescript
interface VectorRecord {
    id: string;              // 对应 Tweet.id
    type: 'tweet' | 'inspiration';
    content: string;         // 用于生成 embedding 的文本
    vector: number[];        // embedding 向量
    createdAt: number;
}
```

## 📋 实施清单

- [x] 1. 扩展 Settings 类型，添加 Embedding 配置
- [x] 2. 创建 IndexedDB 向量存储层 (`src/lib/vectorDB.ts`)
- [x] 3. 创建 Embedding API 调用模块 (`src/lib/embedding.ts`)
- [x] 4. Options 页面添加 Embedding 配置 UI
- [x] 5. 收藏时自动生成 embedding（AI 摘要完成后触发）
- [x] 6. 实现余弦相似度向量搜索
- [x] 7. SidePanel 添加搜索 UI

## ✅ 验收标准

- [x] 用户可配置 Embedding 模型（支持独立配置或使用主配置）
- [x] 收藏内容时自动生成向量（在 AI 摘要完成后）
- [x] 收藏库支持语义搜索
- [x] 搜索结果按相似度排序
- [x] 向量数据存储在本地 IndexedDB

## 📦 交付清单

### 📝 新增文件
- `src/lib/vectorDB.ts` - IndexedDB 向量存储层
- `src/lib/embedding.ts` - Embedding API 调用模块

### 📝 修改文件
- `src/lib/types.ts` - 添加 VectorRecord 类型和 Embedding 配置字段
- `src/background/index.ts` - 添加 Embedding 消息处理
- `src/options/Options.tsx` - 添加 Embedding 配置 UI
- `src/sidepanel/SidePanel.tsx` - 添加搜索 UI 和自动 embedding 生成

## 💡 使用说明

### 1. 配置 Embedding 模型

在设置页面：
1. 启用「语义搜索」开关
2. 填写 Embedding 模型名称（如 `text-embedding-3-small`）
3. 可选：独立配置 API Key 和 Base URL

### 2. 自动向量化

- 收藏内容后，AI 摘要完成时会自动生成向量
- 向量存储在本地 IndexedDB 中

### 3. 语义搜索

- 在收藏库顶部输入搜索词
- 支持自然语言查询（如「关于 AI 产品设计的内容」）
- 结果按相似度排序

## 📊 容量估算

| 内容数量 | 向量维度 | 存储大小 |
|---------|---------|---------|
| 100 条 | 1536 维 | ~2.4 MB |
| 1000 条 | 1536 维 | ~24 MB |
| 5000 条 | 1536 维 | ~120 MB |

## 🔒 隐私说明

- 向量数据完全存储在本地浏览器
- 只有生成向量时需要调用 Embedding API
- 搜索在本地完成，无需联网

